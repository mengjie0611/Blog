<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>mongodb基础入门 | mengjie前端开发</title>
    <meta name="description" content="一个努力的码农">
    <link rel="icon" type="image/x-icon" href="/Blog/img/icon.png">
    
    <link rel="preload" href="/Blog/assets/css/0.styles.edd67a01.css" as="style"><link rel="preload" href="/Blog/assets/js/app.2159d4b3.js" as="script"><link rel="preload" href="/Blog/assets/js/2.14622190.js" as="script"><link rel="preload" href="/Blog/assets/js/23.4b30007b.js" as="script"><link rel="prefetch" href="/Blog/assets/js/10.6a93ff19.js"><link rel="prefetch" href="/Blog/assets/js/11.c47f1757.js"><link rel="prefetch" href="/Blog/assets/js/12.73863227.js"><link rel="prefetch" href="/Blog/assets/js/13.80522e4d.js"><link rel="prefetch" href="/Blog/assets/js/14.68a4f5c6.js"><link rel="prefetch" href="/Blog/assets/js/15.ec00eb3a.js"><link rel="prefetch" href="/Blog/assets/js/16.f582d6c1.js"><link rel="prefetch" href="/Blog/assets/js/17.7b213757.js"><link rel="prefetch" href="/Blog/assets/js/18.b03270d5.js"><link rel="prefetch" href="/Blog/assets/js/19.e05d7c48.js"><link rel="prefetch" href="/Blog/assets/js/20.1bb272e3.js"><link rel="prefetch" href="/Blog/assets/js/21.5777fedf.js"><link rel="prefetch" href="/Blog/assets/js/22.89979eda.js"><link rel="prefetch" href="/Blog/assets/js/24.08c605af.js"><link rel="prefetch" href="/Blog/assets/js/25.3d0a8a58.js"><link rel="prefetch" href="/Blog/assets/js/26.07c0104b.js"><link rel="prefetch" href="/Blog/assets/js/27.24dfab8b.js"><link rel="prefetch" href="/Blog/assets/js/28.46f1bcdc.js"><link rel="prefetch" href="/Blog/assets/js/29.6dc6d7de.js"><link rel="prefetch" href="/Blog/assets/js/3.6c3dee68.js"><link rel="prefetch" href="/Blog/assets/js/30.dcce14df.js"><link rel="prefetch" href="/Blog/assets/js/4.8f84f249.js"><link rel="prefetch" href="/Blog/assets/js/5.236c83d5.js"><link rel="prefetch" href="/Blog/assets/js/6.ce0a3d40.js"><link rel="prefetch" href="/Blog/assets/js/7.44a5767d.js"><link rel="prefetch" href="/Blog/assets/js/8.e33d5460.js"><link rel="prefetch" href="/Blog/assets/js/9.102fdc46.js">
    <link rel="stylesheet" href="/Blog/assets/css/0.styles.edd67a01.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Blog/" class="home-link router-link-active"><img src="/Blog/img/logo.png" alt="mengjie前端开发" class="logo"> <span class="site-name can-hide">mengjie前端开发</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Blog/timeLine/" class="nav-link">首页</a></div><div class="nav-item"><a href="/Blog/technology/" class="nav-link router-link-active">技术</a></div><div class="nav-item"><a href="/Blog/essay/" class="nav-link">随笔</a></div><div class="nav-item"><a href="/Blog/ponder/" class="nav-link">思考</a></div><div class="nav-item"><a href="/Blog/others/" class="nav-link">其他</a></div><div class="nav-item"><a href="/Blog/tags/" class="nav-link">标签</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">链接</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/mengjie0611" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://es6.ruanyifeng.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ES6入门
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav> <div class="mp3-player" data-v-172d32ba>
  音乐
  <div role="switch" class="el-switch" data-v-172d32ba><input type="checkbox" name="" true-value="true" class="el-switch__input"><!----><span class="el-switch__core" style="width:40px;"></span><!----></div> <audio loop="loop" data-v-172d32ba><source src="/Blog/assets/media/7 Years - Lukas Graham.e8dd8397.mp3" type="audio/mpeg" data-v-172d32ba></audio></div></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Blog/timeLine/" class="nav-link">首页</a></div><div class="nav-item"><a href="/Blog/technology/" class="nav-link router-link-active">技术</a></div><div class="nav-item"><a href="/Blog/essay/" class="nav-link">随笔</a></div><div class="nav-item"><a href="/Blog/ponder/" class="nav-link">思考</a></div><div class="nav-item"><a href="/Blog/others/" class="nav-link">其他</a></div><div class="nav-item"><a href="/Blog/tags/" class="nav-link">标签</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">链接</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/mengjie0611" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://es6.ruanyifeng.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ES6入门
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>mongodb基础入门</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Blog/technology/MongoDB%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8.html#第01节：认识和安装mongodb" class="sidebar-link">第01节：认识和安装MongoDB</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Blog/technology/MongoDB%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8.html#第02节：mongo基本命令-1" class="sidebar-link">第02节：Mongo基本命令-1</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Blog/technology/MongoDB%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8.html#第03节：mongo基本命令-2" class="sidebar-link">第03节：Mongo基本命令-2</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Blog/technology/MongoDB%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8.html#第04节：用js文件写mongo命令" class="sidebar-link">第04节：用js文件写mongo命令</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Blog/technology/MongoDB%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8.html#第05节：批量插入的正确方法" class="sidebar-link">第05节：批量插入的正确方法</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Blog/technology/MongoDB%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8.html#第06节：修改：update常见错误" class="sidebar-link">第06节：修改：Update常见错误</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Blog/technology/MongoDB%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8.html#第07节：修改：初识update修改器" class="sidebar-link">第07节：修改：初识update修改器</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Blog/technology/MongoDB%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8.html#第08节：修改：update数组修改器" class="sidebar-link">#第08节：修改：update数组修改器</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Blog/technology/MongoDB%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8.html#第09节：修改：状态返回与安全" class="sidebar-link">第09节：修改：状态返回与安全</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Blog/technology/MongoDB%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8.html#第10节：查询：find的不等修饰符" class="sidebar-link">第10节：查询：find的不等修饰符</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Blog/technology/MongoDB%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8.html#第11节：查询：find的多条件查询" class="sidebar-link">第11节：查询：find的多条件查询</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Blog/technology/MongoDB%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8.html#第12节：查询：find的数组查询" class="sidebar-link">第12节：查询：find的数组查询</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Blog/technology/MongoDB%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8.html#第13节：查询：find的参数使用方法" class="sidebar-link">第13节：查询：find的参数使用方法</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Blog/technology/MongoDB%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8.html#第14节：查询：find如何在js文本中使用" class="sidebar-link">第14节：查询：find如何在js文本中使用</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Blog/technology/MongoDB%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8.html#第15节：索引-构造百万级数据" class="sidebar-link">第15节：索引:构造百万级数据</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Blog/technology/MongoDB%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8.html#第16节：索引：索引入门" class="sidebar-link">第16节：索引：索引入门</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Blog/technology/MongoDB%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8.html#第17节：索引：复合索引" class="sidebar-link">第17节：索引：复合索引</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Blog/technology/MongoDB%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8.html#第18节：索引：全文索引" class="sidebar-link">第18节：索引：全文索引</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Blog/technology/MongoDB%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8.html#第19节：管理-用户的创建、删除与修改" class="sidebar-link">第19节：管理:用户的创建、删除与修改</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Blog/technology/MongoDB%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8.html#第20节：管理：备份和还原" class="sidebar-link">第20节：管理：备份和还原</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Blog/technology/MongoDB%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8.html#第21节：管理：图形界面管理（完结）" class="sidebar-link">第21节：管理：图形界面管理（完结）</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="mongodb基础入门"><a href="#mongodb基础入门" class="header-anchor">#</a> MongoDB基础入门</h1> <p>学习指导：<a href="http://www.jspang.com/posts/2017/12/16/mongodb.html" target="_blank" rel="noopener noreferrer">挑战全栈 MongoDB基础视频教程 (共21集)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>参考：<a href="https://www.runoob.com/mongodb/mongodb-tutorial.html" target="_blank" rel="noopener noreferrer">MongoDB 教程 | 菜鸟教程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="第01节：认识和安装mongodb"><a href="#第01节：认识和安装mongodb" class="header-anchor">#</a> 第01节：认识和安装MongoDB</h2> <ul><li><p><strong>MongoDB是非关系型数据库</strong>，要了解非关系型数据库就必须先了解关系型数据库，关系数据库，是建立在关系模型基础上的数据库。比较有名气的关系型数据库，比如Oracle、DB2、MSSQL、Mysql。</p></li> <li><p>非关系数据库和关系型数据库的区别是什么？</p> <ul><li>实质：非关系型数据库的实质：非关系型数据库产品是传统关系型数据库的功能阉割版，通过减少用不到或很少用的功能，来大幅度提高产品性能。</li> <li>价格：目前的非关系型数据库基本都是免费的，而比较有名气的关系型数据库都是收费的，比如：Oracle、DB2、MSSQL。MySql虽然是免费的，但是处理大型数据还是要提前作很多工作的。</li> <li>功能：实际开发中，很多业务需求，其实并不需要完整的关系型数据库功能，非关系型数据库的功能就足够使用了。这种情况下，使用性能更高、成本更低的非关系型数据库当然是更明智的选择。</li></ul></li> <li><p>了解关系型数据库和非关系型数据库的区别后，需要有一点的取舍，<strong>比较复杂和大型的项目不建议使用非关系型数据库</strong>，但是如果你想作个博客，CMS系统这类业务逻辑不复杂的程序，MongoDB是完全可以胜任的。</p></li> <li><p>MongoDB简介：</p> <ul><li>MongoDB是一个基于分布式文件存储的数据库，由C++语言编写。目的是为WEB应用提供扩展的高性能的数据存储解决方案。</li> <li>MongoDB是一个介于关系型数据库和非关系型数据库之间的产品，是非关系型数据库当中功能最丰富，最像关系数据库的。他支持的数据结构非常松散，是类似json的bson格式，因此可以存储比较复杂的数据类型。</li> <li>Mongo最大的特点是他支持的查询语言非常强大，其语法有点类似于面向对象的查询语言，几乎可以实现类似关系数据库单表查询的绝大部分功能，而且还支持对数据建立索引。</li></ul></li> <li><p>安装忽略</p></li> <li><p><strong>运行MongoDB服务端：</strong></p> <ul><li>安装好MongoDB数据库后，我们需要启用服务端才能使用。启用服务的命令是：Mongod。</li> <li>打开命令行: 先打开运行（快捷键win+R），然后输入cmd后回车，就可以打开命令行工具。</li> <li>执行mongod: 在命令中直接输入mongod，但是你会发现服务并没有启动，报了一个exception，服务停止了。</li> <li>新建文件夹:出现上边的错误，是因为我们没有简历Mongodb需要的文件夹，<code>一般是安装盘的根目录，建立data/db,这两个文件夹</code>。</li> <li>运行mongod：这时候服务就可以开启了，链接默认端口是27017。</li></ul></li> <li><p><strong>链接服务：</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># cmd 输入 mongo</span>
mongo

<span class="token comment">#查看存在数据库命令：</span>
show dbs

<span class="token comment"># 查看数据库版本命令：</span>
db.version<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h2 id="第02节：mongo基本命令-1"><a href="#第02节：mongo基本命令-1" class="header-anchor">#</a> 第02节：Mongo基本命令-1</h2> <ul><li><p><strong>MongoDB的存储结构</strong> 以前我们的关系型数据库的数据结构都是顶层是库，库下面是表，表下面是数据。但是MongoDB有所不同，库下面是集合，集合下面是文件。</p></li> <li><p><strong>基础Shell命令：</strong></p> <ul><li><code>show dbs</code> :显示已有数据库，如果你刚安装好，会默认有<code>local、admin、config</code>，这是MongoDB的默认数据库，我们在新建库时是不允许起这些名称的。</li> <li><code>use admin</code>： 进入数据，也可以理解成为使用数据库。成功会显示：switched to db admin。</li> <li><code>show collections</code>: 显示数据库中的集合（关系型中叫表，我们要逐渐熟悉）。</li> <li><code>db</code>:显示当前位置，也就是你当前使用的数据库名称，这个命令算是最常用的，因为你在作任何操作的时候都要先查看一下自己所在的库，以免造成操作错误。</li></ul></li></ul> <h2 id="第03节：mongo基本命令-2"><a href="#第03节：mongo基本命令-2" class="header-anchor">#</a> 第03节：Mongo基本命令-2</h2> <ul><li><strong>数据操作基础命令：</strong> <ul><li><p><code>use db（建立数据库）</code>：use不仅可以进入一个数据库，如果你敲入的库不存在，它还可以帮你建立一个库。但是在没有集合前，它还是默认为空。</p></li> <li><p><code>db.集合.insert( )</code>:新建数据集合和插入文件（数据），当集合没有时，这时候就可以新建一个集合，并向里边插入数据。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>db.user.insert<span class="token punctuation">(</span><span class="token punctuation">{</span>“name”:”jspang”<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><code>db.集合.find( )</code>:查询所有数据，这条命令会列出集合下的所有数据，可以看到MongoDB是自动给我们加入了索引值的。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>db.user.find<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><code>db.集合.findOne( )</code>:查询第一个文件数据，这里需要注意的，所有MongoDB的组合单词都使用首字母小写的驼峰式写法。</p></li> <li><p><code>db.集合.update({查询},{修改})</code>:修改文件数据，第一个是查询条件，第二个是要修改成的值。这里注意的是可以多加文件数据项的，比如下面的例子。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>db.jspang.update<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;jspang&quot;</span><span class="token punctuation">}</span>,<span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;jspang&quot;</span>,<span class="token string">&quot;age&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;32&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><code>db.集合.remove(条件)</code>：删除文件数据，注意的是要跟一个条件。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>db.user.remove<span class="token punctuation">(</span><span class="token punctuation">{</span>“name”:”jspang”<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><code>db.集合.drop()</code>:删除整个集合，这个在实际工作中一定要谨慎使用，如果是程序，一定要二次确认。</p></li> <li><p><code>db.dropDatabase()</code>: 删除整个数据库，在删除库时，一定要先进入数据库，然后再删除。实际工作中这个基本不用，实际工作可定需要保留数据和痕迹的。</p></li></ul></li></ul> <h2 id="第04节：用js文件写mongo命令"><a href="#第04节：用js文件写mongo命令" class="header-anchor">#</a> 第04节：用js文件写mongo命令</h2> <ul><li><p>编写执行代码</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ./mongoShell/goTask.js</span>

<span class="token keyword">var</span> userName <span class="token operator">=</span> <span class="token string">'jspang'</span>  <span class="token comment">// 声明一个登录名  </span>
<span class="token keyword">var</span> timeStamp <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 声明登录时的时间戳  </span>
<span class="token keyword">var</span> jsonDdatabase <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token comment">// 组成JSON字符串</span>
  <span class="token string">&quot;loginUnser&quot;</span><span class="token operator">:</span> userName<span class="token punctuation">,</span>
  <span class="token string">&quot;loginTime&quot;</span><span class="token operator">:</span> timeStamp
<span class="token punctuation">}</span>
<span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'log'</span><span class="token punctuation">)</span>  <span class="token comment">//链接数据库</span>
db<span class="token punctuation">.</span>login<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>jsonDdatabase<span class="token punctuation">)</span> <span class="token comment">//插入数据</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'[demo]log  print success'</span><span class="token punctuation">)</span>  <span class="token comment">//没有错误显示成功</span>
</code></pre></div></li> <li><p>执行</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 链接数据库(cmd)</span>
mongo

mongo goTask.js

show dbs
use log
show collections
db.login.find<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h2 id="第05节：批量插入的正确方法"><a href="#第05节：批量插入的正确方法" class="header-anchor">#</a> 第05节：批量插入的正确方法</h2> <ul><li><p>在操作数据库时要注意两个能力：</p> <ul><li>第一个是快速存储能力。</li> <li>第二个是方便迅速查询能力。</li></ul></li> <li><p><strong>批量插入</strong></p> <ul><li><p>批量数据插入是以数组的方式进行的（如果写错，可以3个回车可以切出来）</p></li> <li><p>插入数据测试</p> <div class="language-bash extra-class"><pre class="language-bash"><code>db.test.insert<span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span><span class="token string">&quot;_id&quot;</span>:1<span class="token punctuation">}</span>,
    <span class="token punctuation">{</span><span class="token string">&quot;_id&quot;</span>:2<span class="token punctuation">}</span>,
    <span class="token punctuation">{</span><span class="token string">&quot;_id&quot;</span>:3<span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 3.2版本以前的用法</span>
db.test.batchInsert<span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span><span class="token string">&quot;_id&quot;</span>:1<span class="token punctuation">}</span>,
    <span class="token punctuation">{</span><span class="token string">&quot;_id&quot;</span>:2<span class="token punctuation">}</span>,
    <span class="token punctuation">{</span><span class="token string">&quot;_id&quot;</span>:3<span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>注意一次插入不要超过48M，向.zip和大图片什么的尽量用静态存储，MongoDB存储静态路径就好。</p></li></ul></li> <li><p><strong>批量插入性能测试</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 一个个插入  执行insertTest1.js  耗时622ms</span>
mongo insertTest1.js

<span class="token comment"># 批量插入  执行insertTest2.js  耗时15ms</span>
mongo insertTest2.js
</code></pre></div></li> <li><p>总结：在工作中一定要照顾数据库性能，这也是你水平的提现，一个技术会了很简单，但是要作精通不那么简单。学完这节，记得在工作中如果在循环插入和批量插入举起不定，那就选批量插入吧，它会给我们更优的性能体验。</p></li> <li><p>范式流程：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'company'</span><span class="token punctuation">)</span>  <span class="token comment">// 连接数据库</span>
<span class="token keyword">var</span> workmateArray <span class="token operator">=</span> <span class="token punctuation">[</span>workmate1<span class="token punctuation">,</span> workmate2<span class="token punctuation">,</span> workmate3<span class="token punctuation">]</span>
db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>workmateArray<span class="token punctuation">)</span>  <span class="token comment">// 数据库插入集合</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'[SUCCESS]: The data was inserted successfully.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h2 id="第06节：修改：update常见错误"><a href="#第06节：修改：update常见错误" class="header-anchor">#</a> 第06节：修改：Update常见错误</h2> <p>了解常见的错误操作</p> <h2 id="第07节：修改：初识update修改器"><a href="#第07节：修改：初识update修改器" class="header-anchor">#</a> 第07节：修改：初识update修改器</h2> <ul><li><p><strong><code>$set</code>修改器</strong></p> <p>用来修改一个指定的键值(key)，这时候我们要修改上节课的sex和age就非常方便了，只要一句话就可以搞定。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;MinJie&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">&quot;$set&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>sex<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span>age<span class="token operator">:</span><span class="token number">21</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>修改好后，我们可以用db.workmate.find()来进行查看</p></li> <li><p><strong>修改嵌套内容(内嵌文档)</strong></p> <p>skill数据是内嵌的，这时候我们可以属性的形式进行修改，skill.skillThree</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;MinJie&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $set<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;skill.skillThree&quot;</span><span class="token operator">:</span> <span class="token string">'word'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong><code>$unset</code>用于将key删除</strong></p> <p>作用其实就是删除一个key值和键</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;MinJie&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $unset<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;age&quot;</span><span class="token operator">:</span> <span class="token string">''</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 直接用set进行添加</span>
</code></pre></div></li> <li><p><strong><code>$inc</code>对数字进行计算</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;MinJie&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $inc<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;age&quot;</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">2</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong><code>multi</code>选项</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $set<span class="token operator">:</span> <span class="token punctuation">{</span> interset<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'basketball'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> multi<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//每个数据都发生了改变，multi是有ture和false两个值，true代表全部修改，false代表只修改一个（默认值）</span>
</code></pre></div></li> <li><p><strong><code>upsert</code>选项</strong></p> <p>upsert是在找不到值的情况下，直接插入这条数据</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'xiaoWang'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $set<span class="token operator">:</span> <span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> upsert<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// upsert也有两个值：true代表没有就添加，false代表没有不添加(默认值)</span>
</code></pre></div></li></ul> <h2 id="第08节：修改：update数组修改器"><a href="#第08节：修改：update数组修改器" class="header-anchor">#</a> <a href="http://www.jspang.com/posts/2017/12/16/mongodb.html#%E7%AC%AC08%E8%8A%82%EF%BC%9A%E4%BF%AE%E6%94%B9%EF%BC%9Aupdate%E6%95%B0%E7%BB%84%E4%BF%AE%E6%94%B9%E5%99%A8" target="_blank" rel="noopener noreferrer">#<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>第08节：修改：update数组修改器</h2> <ul><li><p><strong><code>$push</code>追加数组/内嵌文档值</strong></p> <p><code>$push</code>的功能是追加数组中的值，但我们也经常用它操作内嵌稳文档，就是{}对象型的值</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// $push追加数组/内嵌文档值</span>
db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'xiaoWang'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $push<span class="token operator">:</span> <span class="token punctuation">{</span> interest<span class="token operator">:</span> <span class="token string">'draw'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// $push修饰符还可以为内嵌文档增加值</span>
db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'MinJie'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $push<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;skill.skillFour&quot;</span><span class="token operator">:</span> <span class="token string">'draw'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong><code>$push</code>修饰符还可以为内嵌文档增加值</strong></p></li> <li><p><strong><code>$ne</code>查找是否存在</strong></p> <p><strong>检查一个值是否存在，如果不存在再执行操作，存在就不执行</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'xiaoWang'</span><span class="token punctuation">,</span> <span class="token string">&quot;interest&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> $ne<span class="token operator">:</span> <span class="token string">'playGame'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $push<span class="token operator">:</span> <span class="token punctuation">{</span> interest<span class="token operator">:</span> <span class="token string">'playGame'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 总结：没有则修改，有则不修改。</span>
</code></pre></div></li> <li><p><strong><code>$addToSet</code> 升级版的<code>$ne</code></strong></p> <p><code>$ne</code>的升级版本（查找是否存在，不存在就push上去），操作起来更直观和方便，所以再工作中这个要比<code>$en</code>用的多。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 查看小王(xiaoWang)兴趣(interest)中有没有阅读（readBook）这项，没有则加入读书(readBook)的兴趣.</span>

db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;xiaoWang&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $addToSet<span class="token operator">:</span> <span class="token punctuation">{</span> interest<span class="token operator">:</span> <span class="token string">&quot;readBook&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong><code>$each</code>批量追加</strong></p> <p>可以传入一个数组，一次增加多个值进去，相当于批量操作，性能同样比循环操作要好很多，这个是需要我们注意的，工作中也要先组合成数组，然后用批量的形式进行操作。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 给xiaoWang,一次加入三个爱好，唱歌（Sing），跳舞（Dance），编码（Code）</span>

<span class="token keyword">var</span> newInterset <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;Sing&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Dance&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Code&quot;</span><span class="token punctuation">]</span>
db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;xiaoWang&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $addToSet<span class="token operator">:</span> <span class="token punctuation">{</span> interest<span class="token operator">:</span> <span class="token punctuation">{</span> $each<span class="token operator">:</span> newInterset <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong><code>$pop</code> 删除数组值</strong></p> <p><code>$pop</code>只删除一次，并不是删除所有数组中的值。而且它有两个选项，一个是1和-1。</p> <p>1：从数组末端进行删除；  -1：从数组开端进行删除</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'xiaoWang'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $pop<span class="token operator">:</span> <span class="token punctuation">{</span> interest<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong><code>interest.int</code> 数组定位修改</strong></p> <p>修改数组的第几位，但并不知道是什么，这时候我们可以使用<code>interest.int</code> 的形式</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 修改xiaoWang的第三个兴趣为编码（Code），注意这里的计数是从0开始的</span>

db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'xiaoWang'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $set<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;interest.2&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Code&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h2 id="第09节：修改：状态返回与安全"><a href="#第09节：修改：状态返回与安全" class="header-anchor">#</a> 第09节：修改：状态返回与安全</h2> <p>在修改时我们都会用<code>findAndModify</code>，它可以给我们返回来一些必要的参数，让我们对修改多了很多控制力，控制力的加强也就是对安全的强化能力加强。</p> <ul><li><p><strong>应答式写入</strong></p> <p>在之前的操作都是非应答式写入，就是在操作完数据库后，它并没有给我们任何的回应和返回值，而是我们自己安慰自己写了一句话 <code>print(‘[update]:The data was updated successfully’)</code>。这在工作中是不允许的，因为根本不能提现我们修改的结果。应答式写入就会给我们直接返回结果（报表），结果里边的包含项会很多，这样我们就可以很好的进行程序的控制和安全机制的处理。有点像前端调用后端接口，无论作什么，后端都要给我一些状态字一样。</p></li> <li><p><strong><code>db.runCommand( )</code></strong></p> <p>它是数据库运行命令的执行器，执行命令首选就要使用它，因为它在Shell和驱动程序间提供了一致的接口。（几乎操作数据库的所有操作，都可以使用<code>runCommand来执行</code>）现在我们试着用<code>runCommand</code>来修改数据库，看看结果和直接用<code>db.collections.update</code>有什么不同。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 修改了所有男士的数据，每个人增加了1000元钱(money)，然后用db.runCommand()执行</span>
db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> sex<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $set<span class="token operator">:</span> <span class="token punctuation">{</span> money<span class="token operator">:</span> <span class="token number">1000</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> resultMessage <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">runCommand</span><span class="token punctuation">(</span><span class="token punctuation">{</span> getLastError<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">printjson</span><span class="token punctuation">(</span>resultMessage<span class="token punctuation">)</span>

<span class="token comment">/*
false：第一句末尾的false是upsert的简写，代表没有此条数据时不增加;
true：true是multi的简写，代表修改所有，这两个我们在前边课程已经学过。
getLastError:1 :表示返回功能错误，这里的参数很多，如果有兴趣请自行查找学习，
printjson：表示以json对象的格式输出到控制台。
*/</span>

<span class="token comment">// 执行返回结果</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;connectionId&quot;</span> <span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
  <span class="token string">&quot;updatedExisting&quot;</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string">&quot;n&quot;</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">&quot;syncMillis&quot;</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token string">&quot;writtenTo&quot;</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token string">&quot;err&quot;</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token string">&quot;ok&quot;</span> <span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>查看是否和数据库链接成功</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>db<span class="token punctuation">.</span><span class="token function">runCommand</span><span class="token punctuation">(</span><span class="token punctuation">{</span> ping<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 返回ok：1就代表链接正常</span>
<span class="token comment">/*
connecting to: mongodb://127.0.0.1:27017/company
Implicit session: session { &quot;id&quot; : UUID(&quot;f8e213c6-c27b-4282-be47-df5a76eb72ae&quot;) }
MongoDB server version: 4.0.10
true
*/</span>
</code></pre></div></li> <li><p><strong>findAndModify</strong></p> <ul><li><p><code>findAndModify</code>是查找并修改的意思。配置它可以在修改后给我们返回修改的结果</p></li> <li><p><strong><code>findAndModify</code>属性值：</strong></p> <ul><li><code>query</code>：需要查询的条件/文档</li> <li><code>sort</code>: 进行排序</li> <li><code>remove：[boolean]</code>是否删除查找到的文档，值填写true，可以删除。</li> <li><code>new:[boolean]</code>返回更新前的文档还是更新后的文档。</li> <li><code>fields</code>：需要返回的字段</li> <li><code>upsert</code>：没有这个值是否增加。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// findAndModify是查找并修改的意思。配置它可以在修改后给我们返回修改的结果</span>
<span class="token keyword">var</span> myModify <span class="token operator">=</span> <span class="token punctuation">{</span>
  findAndModify<span class="token operator">:</span> <span class="token string">&quot;workmate&quot;</span><span class="token punctuation">,</span>
  query<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'JSPang'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  update<span class="token operator">:</span> <span class="token punctuation">{</span> $set<span class="token operator">:</span> <span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token number">18</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span><span class="token operator">:</span> <span class="token boolean">true</span>    <span class="token comment">// 更新完成，需要查看结果，如果为false不进行查看结果</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> ResultMessage <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">runCommand</span><span class="token punctuation">(</span>myModify<span class="token punctuation">)</span>
<span class="token function">printjson</span><span class="token punctuation">(</span>ResultMessage<span class="token punctuation">)</span>

<span class="token comment">// 返回结果  是最新的JSPang 数据</span>
</code></pre></div></li> <li><p><code>findAndModify</code>的性能是没有直接使用<code>db.collections.update</code>的性能好，但是在实际工作中都是使用它，毕竟要商用的程序安全性还是比较重要的。</p></li></ul></li></ul> <h2 id="第10节：查询：find的不等修饰符"><a href="#第10节：查询：find的不等修饰符" class="header-anchor">#</a> 第10节：查询：find的不等修饰符</h2> <ul><li><p>基础查找</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 简单查找</span>
db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">&quot;skill.skillOne&quot;</span><span class="token operator">:</span> <span class="token string">&quot;HTML + CSS&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 筛选字段</span>
db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> <span class="token string">&quot;skill.skillOne&quot;</span><span class="token operator">:</span> <span class="token string">&quot;HTML+CSS&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string">&quot;skill.skillOne&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    _id<span class="token operator">:</span> <span class="token boolean">false</span>  <span class="token comment">// 不显示_id</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong>不等修饰符</strong></p> <ul><li><code>小于($lt)</code> : 英文全称less-than</li> <li><code>小于等于($lte)</code> ： 英文全称less-than-equal</li> <li><code>大于($gt)</code> : 英文全称greater-than</li> <li><code>大于等于($gte)</code>: 英文全称greater-than-equal</li> <li><code>不等于($ne)</code>: 英文全称not-equal</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 不等查找  年龄小于30大于25岁的人</span>
db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token punctuation">{</span> $lte<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span> $gte<span class="token operator">:</span> <span class="token number">25</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">&quot;skill.skillOne&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> _id<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong>日期查找</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> startDate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">'01/01/2018'</span><span class="token punctuation">)</span>

db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> regeditTime<span class="token operator">:</span> <span class="token punctuation">{</span> $gt<span class="token operator">:</span> startDate <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">&quot;skill.skillOne&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> _id<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre></div></li> <li><p>vscode清屏 <code>cls</code></p></li></ul> <h2 id="第11节：查询：find的多条件查询"><a href="#第11节：查询：find的多条件查询" class="header-anchor">#</a> 第11节：查询：find的多条件查询</h2> <ul><li><p><strong><code>$in</code>修饰符</strong> ：in修饰符可以轻松解决一键多值的查询情况</p></li> <li><p><strong><code>$in</code>相对的修饰符是<code>$nin</code>修饰符</strong></p></li> <li><p><strong><code>$or</code>修饰符</strong>：用来查询多个键值的情况</p></li> <li><p><strong><code>$nor</code>修饰符</strong></p></li> <li><p><strong><code>$and</code>修饰符</strong>：用来查找几个key值都满足的情况</p></li> <li><p><strong><code>$not</code>修饰符</strong>： 用来查询除条件之外的值</p></li> <li><p>查询演示：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'company'</span><span class="token punctuation">)</span>

<span class="token comment">// $in 修饰符</span>
db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  age<span class="token operator">:</span> <span class="token punctuation">{</span>
    $<span class="token keyword">in</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string">&quot;skill.skillOne&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    _id<span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token comment">// $or修饰符  查出年龄大于30岁的，或者会做PHP的信息</span>
db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  $or<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token punctuation">{</span> $gt3<span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;skill.skillThree&quot;</span><span class="token operator">:</span> <span class="token string">'PHP'</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string">&quot;skill.skillThree&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    _id<span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>


<span class="token comment">// $and用来查找几个key值都满足 查询同事中大于30岁并且会做PHP的信息</span>
db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  $and<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token punctuation">{</span> $gte<span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;skill.skillThree&quot;</span><span class="token operator">:</span> <span class="token string">'PHP'</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string">&quot;skill.skillThree&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    _id<span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token comment">// $not修饰符  用来查询除条件之外的值，比如我们现在要查找除年龄大于20岁，小于30岁的人员信息</span>
db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  age<span class="token operator">:</span> <span class="token punctuation">{</span>
    $not<span class="token operator">:</span> <span class="token punctuation">{</span>
      $lte<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
      $gte<span class="token operator">:</span> <span class="token number">20</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string">&quot;skill.skillOne&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    _id<span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre></div></li></ul> <h2 id="第12节：查询：find的数组查询"><a href="#第12节：查询：find的数组查询" class="header-anchor">#</a> 第12节：查询：find的数组查询</h2> <ul><li><p><strong>基本数组查询</strong></p></li> <li><p><strong><code>$all</code>数组多项查询</strong> ： 对数组中的对象进行查询，是需要满足所有条件的</p></li> <li><p><strong><code>$in</code>数组的或者查询</strong> ： 满足数组中的一项就可以被查出来</p></li> <li><p><strong><code>$size</code>数组个数查询</strong> : 根据数组的数量查询出结果</p></li> <li><p><strong><code>$slice</code>显示选项</strong>: 并不需要显示出数组中的所有值，而是只显示前两项</p></li> <li><p>查询演示：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 基本数组查询</span>
<span class="token comment">// 查询一个人的爱好是’画画’,’聚会’,’看电影’</span>
db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    interest<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'画画'</span><span class="token punctuation">,</span> <span class="token string">'聚会'</span><span class="token punctuation">,</span> <span class="token string">'看电影'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    interest<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    _id<span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span> 
<span class="token punctuation">)</span>

<span class="token comment">// 查出看兴趣中有看电影的员工信息</span>
db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  interest<span class="token operator">:</span> <span class="token string">'看电影'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    interest<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    _id<span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>


<span class="token comment">// $all-数组多项查询  查询出喜欢看电影和看书的人员信息</span>
db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  interest<span class="token operator">:</span> <span class="token punctuation">{</span>
    $all<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'看电影'</span><span class="token punctuation">,</span> <span class="token string">'看书'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    interest<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    _id<span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span> 
<span class="token punctuation">)</span>


<span class="token comment">// $in-数组的或者查询</span>
<span class="token comment">// 用$all修饰符，是需要满足所有条件的，</span>
<span class="token comment">// $in主要满足数组中的一项就可以被查出来（有时候会跟$or弄混）</span>
<span class="token comment">// 查询爱好中有看电影的或者看书的员工信息</span>
db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  interest<span class="token operator">:</span> <span class="token punctuation">{</span>
    $<span class="token keyword">in</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'看电影'</span><span class="token punctuation">,</span> <span class="token string">'看书'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    interest<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    _id<span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>


<span class="token comment">// $size-数组个数查询</span>
<span class="token comment">// $size修饰符可以根据数组的数量查询出结果。</span>
<span class="token comment">// 查找兴趣的数量是5个人员信息</span>
db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  interest<span class="token operator">:</span> <span class="token punctuation">{</span>
    $size<span class="token operator">:</span> <span class="token number">5</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    interest<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    _id<span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>


<span class="token comment">// $slice-显示选项</span>
<span class="token comment">// 有时候我并不需要显示出数组中的所有值，而是只显示前两项，</span>
<span class="token comment">// 比如我们现在想显示每个人兴趣的前两项，而不是把每个人所有的兴趣都显示出来</span>
db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// interest: {</span>
  <span class="token comment">//   $size: 5</span>
  <span class="token comment">// }</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    interest<span class="token operator">:</span> <span class="token punctuation">{</span>$slice<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    _id<span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
<span class="token comment">// 想显示兴趣的最后一项，可以直接使用slice:-1，来进行查询</span>
</code></pre></div></li></ul> <h2 id="第13节：查询：find的参数使用方法"><a href="#第13节：查询：find的参数使用方法" class="header-anchor">#</a> 第13节：查询：find的参数使用方法</h2> <p><strong>在操作<code>find方法</code>的<code>第一个参数（query）</code>和<code>第二个参数（fields）</code>。<code>find</code>还有几个常用的参数，这些参数多用在分页和排序上</strong></p> <ul><li><p><code>find</code>参数：</p> <ul><li><code>query</code>：这个就是查询条件，MongoDB默认的第一个参数。</li> <li><code>fields</code>：（返回内容）查询出来后显示的结果样式，可以用true和false控制是否显示。</li> <li><code>limit</code>：返回的数量，后边跟数字，控制每次查询返回的结果数量。</li> <li><code>skip</code>: 跳过多少个显示，和limit结合可以实现分页。</li> <li><code>sort</code>：排序方式，从小到大排序使用1，从大到小排序使用-1</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 分页展示</span>
db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        age<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        _id<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong><code>$where</code>修饰符</strong></p> <p>它是一个非常强大的修饰符，但强大的背后也意味着有风险存在。它可以让我们在条件里使用javascript的方法来进行复杂查询。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 查询年龄大于30岁的人员</span>
db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span> $where<span class="token operator">:</span> <span class="token string">&quot;this.age&gt;30&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> _id<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
<span class="token comment">// this指向的是workmate（查询集合）本身。</span>
<span class="token comment">// 这样我们就可以在程序中随意调用。</span>
<span class="token comment">// 虽然强大和灵活，但是这种查询对于数据库的压力和安全性都会变重，</span>
<span class="token comment">// 所以在工作中尽量减少$where修饰符的使用。</span>
</code></pre></div></li></ul> <h2 id="第14节：查询：find如何在js文本中使用"><a href="#第14节：查询：find如何在js文本中使用" class="header-anchor">#</a> 第14节：查询：find如何在js文本中使用</h2> <ul><li><p><code>find</code>查询如何才终端中<code>load()</code>执行</p></li> <li><p><strong>hasNext循环结果</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// hasNext循环结果</span>

<span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;company&quot;</span><span class="token punctuation">)</span>  <span class="token comment">// 进行链接对应的集合collections</span>
<span class="token keyword">var</span> result <span class="token operator">=</span> db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 声明变量result，并把查询结果赋值给result</span>
<span class="token comment">// 利用游标的hasNext()进行循环输出结果。</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">printjson</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">//用json格式打印结果</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p><strong><code>forEach</code>循环</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// forEach循环</span>
<span class="token comment">// 利用hasNext循环结果，需要借助while的帮助，</span>
<span class="token comment">// MongoDB也为我们提供了forEach循环，现在修改上边的代码，使用forEach循环来输出结果。</span>

<span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;company&quot;</span><span class="token punctuation">)</span>  <span class="token comment">// 进行链接对应的集合collections</span>
<span class="token keyword">var</span> result <span class="token operator">=</span> db<span class="token punctuation">.</span>workmate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 声明变量result，并把查询结果赋值给result</span>
<span class="token comment">// 利用forEach循环</span>
result<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">printjson</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><code>forEach</code>循环更为优雅。这两种方法都是非常不错的,凭借自己爱好进行选择吧</p></li></ul> <h2 id="第15节：索引-构造百万级数据"><a href="#第15节：索引-构造百万级数据" class="header-anchor">#</a> 第15节：索引:构造百万级数据</h2> <ul><li><p>构造百万级的数据集合</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 构造百万级的数据集合</span>

<span class="token comment">// 生成随机数</span>
<span class="token keyword">function</span> <span class="token function">GetRandomNum</span><span class="token punctuation">(</span><span class="token parameter">min<span class="token punctuation">,</span> max</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> range <span class="token operator">=</span> max <span class="token operator">-</span> min  <span class="token comment">//得到随机数区间</span>
  <span class="token keyword">let</span> rand <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//得到随机值</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>min <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>rand <span class="token operator">*</span> range<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//最小值+随机数取整 </span>
<span class="token punctuation">}</span>
<span class="token comment">// console.log(GetRandomNum(10000, 99999))</span>

<span class="token comment">// 生成随机用户名</span>
<span class="token keyword">function</span> <span class="token function">GetRadomUserName</span><span class="token punctuation">(</span><span class="token parameter">min<span class="token punctuation">,</span> max</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> tempStringArray <span class="token operator">=</span> <span class="token string">&quot;123456789qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM&quot;</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token comment">//构造生成时的字母库数组</span>
  <span class="token keyword">let</span> outPuttext <span class="token operator">=</span> <span class="token string">&quot;&quot;</span> <span class="token comment">// 最后输出的变量</span>
  <span class="token comment">// 进行循环，随机生产用户名的长度，这里需要生成随机数方法的配合</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">GetRandomNum</span><span class="token punctuation">(</span>min<span class="token punctuation">,</span> max<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 随机抽取字母，拼装成需要的用户名</span>
    outPuttext <span class="token operator">=</span> outPuttext <span class="token operator">+</span> tempStringArray<span class="token punctuation">[</span><span class="token function">GetRandomNum</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> tempStringArray<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> outPuttext
<span class="token punctuation">}</span>
<span class="token comment">// console.log(GetRadomUserName(7, 16))</span>

<span class="token comment">// 插入200万数据</span>
<span class="token keyword">var</span> startTime <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'company'</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span>randomInfo<span class="token punctuation">.</span><span class="token function">drop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> tempInfo <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">2000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  tempInfo<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    username<span class="token operator">:</span> <span class="token function">GetRadomUserName</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    regeditTime<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    randNum0<span class="token operator">:</span> <span class="token function">GetRandomNum</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">,</span> <span class="token number">999999</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    randNum1<span class="token operator">:</span> <span class="token function">GetRandomNum</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">,</span> <span class="token number">999999</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    randNum2<span class="token operator">:</span> <span class="token function">GetRandomNum</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">,</span> <span class="token number">999999</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    randNum3<span class="token operator">:</span> <span class="token function">GetRandomNum</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">,</span> <span class="token number">999999</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    randNum4<span class="token operator">:</span> <span class="token function">GetRandomNum</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">,</span> <span class="token number">999999</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    randNum5<span class="token operator">:</span> <span class="token function">GetRandomNum</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">,</span> <span class="token number">999999</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    randNum6<span class="token operator">:</span> <span class="token function">GetRandomNum</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">,</span> <span class="token number">999999</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    randNum7<span class="token operator">:</span> <span class="token function">GetRandomNum</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">,</span> <span class="token number">999999</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    randNum8<span class="token operator">:</span> <span class="token function">GetRandomNum</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">,</span> <span class="token number">999999</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    randNum8<span class="token operator">:</span> <span class="token function">GetRandomNum</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">,</span> <span class="token number">999999</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

db<span class="token punctuation">.</span>randomInfo<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>tempInfo<span class="token punctuation">)</span>
<span class="token keyword">var</span> endTime <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;[demo]:------&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> startTime<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;ms&quot;</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>使用 <code>db.randomInfo.stats()</code>这个命令查看数据中的数据条数</p></li></ul> <h2 id="第16节：索引：索引入门"><a href="#第16节：索引：索引入门" class="header-anchor">#</a> 第16节：索引：索引入门</h2> <ul><li><p><strong>索引查询</strong> --- 普通查询性能</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 索引查询 --- 普通查询性能</span>
<span class="token keyword">var</span> startTime <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'company'</span><span class="token punctuation">)</span>
<span class="token comment">// 跳过 5000 查询  db.randomInfo.find().skip(50000)</span>
<span class="token keyword">var</span> result <span class="token operator">=</span> db<span class="token punctuation">.</span>randomInfo<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  username<span class="token operator">:</span><span class="token string">&quot;undefined4pi4n&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

result<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">printjson</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> endTime <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;[SUCCESS]:THIS RUN TIME IS:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> startTime<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;ms&quot;</span><span class="token punctuation">)</span>

<span class="token comment">// 查询时间 875ms左右</span>
</code></pre></div></li> <li><p><strong>建立索引</strong> <code>createIndex()</code></p> <blockquote><p><em>注意在 3.0.0 版本前创建索引方法为 db.collection.ensureIndex()，之后的版本使用了 db.collection.createIndex() 方法，ensureIndex() 还能用，但只是 createIndex() 的别名。</em></p></blockquote> <ul><li><p>语法</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span>keys<span class="token punctuation">,</span> options<span class="token punctuation">)</span>

<span class="token comment">// 语法中 Key 值为你要创建的索引字段，1 为指定按升序创建索引，如果你想按降序来创建索引指定为 -1 即可。</span>
</code></pre></div></li> <li><p>用法实例：</p></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 建立索引  --- 试着为用户名（username）建立索引</span>
db<span class="token punctuation">.</span>randomInfo<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token punctuation">{</span> username<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// or</span>
db<span class="token punctuation">.</span>randomInfo<span class="token punctuation">.</span><span class="token function">ensureIndex</span><span class="token punctuation">(</span><span class="token punctuation">{</span> username<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 复合索引</span>
db<span class="token punctuation">.</span>col<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;title&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;description&quot;</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong>查看现有索引</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 查看现有索引</span>

db<span class="token punctuation">.</span>randomInfo<span class="token punctuation">.</span><span class="token function">getIndexes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>建立索引后再次执行查询 <code>load('./index_demo2.js')</code>，时间下降到 7ms了，随机波动，不超过20ms</p></li> <li><p>无论是在关系型数据库还是文档数据库，建立索引都是非常重要的。索引这东西是要消耗硬盘和内存资源的，所以还是要根据程序需要进行建立了。<strong>MongoDB也给我们进行了限制，只允许我们建立64个索引值</strong>。</p></li></ul> <h2 id="第17节：索引：复合索引"><a href="#第17节：索引：复合索引" class="header-anchor">#</a> 第17节：索引：复合索引</h2> <ul><li><p><strong>索引中的小坑</strong></p> <ul><li><p>通过实际开发和性能对比，总结了几条不用索引的情况（不一定对，但是自己的经验之谈）。</p></li> <li><p>数据不超万条时，不需要使用索引。性能的提升并不明显，而大大增加了内存和硬盘的消耗。</p></li> <li><p>查询数据超过表数据量30%时，不要使用索引字段查询。实际证明会比不使用索引更慢，因为它大量检索了索引表和我们原表。（如查询员工的性别）</p></li> <li><p>数字索引，要比字符串索引快的多，在百万级甚至千万级数据量面前，使用数字索引是个明确的选择。</p></li> <li><p>把你经常查询的数据做成一个内嵌数据（对象型的数据），然后集体进行索引。</p></li></ul></li> <li><p><strong>复合索引</strong> : 复合索引就是两条以上的索引</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// db.randomInfo.ensureIndex({ username: 1 })</span>

<span class="token comment">// 增加建立randNum0 的索引</span>
db<span class="token punctuation">.</span>randomInfo<span class="token punctuation">.</span><span class="token function">ensureIndex</span><span class="token punctuation">(</span><span class="token punctuation">{</span>randNum0<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 查看现有索引</span>
db<span class="token punctuation">.</span>randomInfo<span class="token punctuation">.</span><span class="token function">getIndexes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong>两个索引同时查询</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> startTime <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'company'</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> result <span class="token operator">=</span> db<span class="token punctuation">.</span>randomInfo<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  username<span class="token operator">:</span> <span class="token string">&quot;undefined4pi4n&quot;</span><span class="token punctuation">,</span>
  randNum0<span class="token operator">:</span> <span class="token number">565509</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

result<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">printjson</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> endTime <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;[SUCCESS]:THIS RUN TIME IS:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> startTime<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;ms&quot;</span><span class="token punctuation">)</span>

<span class="token comment">// 查询时间 8ms</span>
<span class="token comment">// 从性能上看并没有什么特殊的变化，查询时间还是在8ms左右。</span>
<span class="token comment">// MongoDB的复合查询是按照我们的索引顺序进行查询的</span>
</code></pre></div></li> <li><p>执行查询 <code>load('./index_demo3.js')</code></p></li> <li><p><strong>指定索引查询（<code>hint</code>）</strong></p> <p>数字的索引要比字符串的索引快，这就需要一个方法来打破索引表的查询顺序，用我们自己指定的索引优先查询，这个方法就是<code>hint()</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 打破索引表的查询顺序</span>
<span class="token keyword">var</span> result <span class="token operator">=</span> db<span class="token punctuation">.</span>randomInfo<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  username<span class="token operator">:</span> <span class="token string">&quot;undefined4pi4n&quot;</span><span class="token punctuation">,</span>
  randNum0<span class="token operator">:</span> <span class="token number">565509</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hint</span><span class="token punctuation">(</span><span class="token punctuation">{</span> randNum0<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong>删除索引</strong></p> <p>当索引性能不佳或起不到作用时，我们需要删除索引，删除索引的命令是<code>dropIndex()</code>.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>db<span class="token punctuation">.</span>randomInfo<span class="token punctuation">.</span><span class="token function">dropIndex</span><span class="token punctuation">(</span><span class="token string">'randNum0_1'</span><span class="token punctuation">)</span> <span class="token comment">//索引的唯一ID</span>

<span class="token comment">// 删除时填写的值，并不是我们的字段名称（key），而是我们索引查询表中的name值</span>
</code></pre></div></li></ul> <h2 id="第18节：索引：全文索引"><a href="#第18节：索引：全文索引" class="header-anchor">#</a> 第18节：索引：全文索引</h2> <ul><li><p>准备数据</p></li> <li><p><strong>建立全文索引</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 建立全文索引</span>
db<span class="token punctuation">.</span>info<span class="token punctuation">.</span><span class="token function">ensureIndex</span><span class="token punctuation">(</span><span class="token punctuation">{</span> contextInfo<span class="token operator">:</span> <span class="token string">'text'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 需要注意的是这里使用text关键词来代表全文索引，我们在这里就不建立数据模型了</span>
</code></pre></div></li> <li><p><strong>全文索引查找</strong></p> <ul><li><p>建立好了全文索引就可以查找了，查找时需要两个关键修饰符:</p></li> <li><p><code>$text</code>: 表示要在全文索引中查东西。</p></li> <li><p><code>$search</code>:后边跟查找的内容。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>db<span class="token punctuation">.</span>info<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>$text<span class="token operator">:</span><span class="token punctuation">{</span>$search<span class="token operator">:</span><span class="token string">&quot;programmer&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul></li> <li><p><strong>查找多个词</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 全文索引是支持多个次查找的，</span>
<span class="token comment">// 查找数据中有programmer，family，diary，drink的数据（这是或的关系），所以两条数据都会出现</span>
db<span class="token punctuation">.</span>info<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> $text<span class="token operator">:</span> <span class="token punctuation">{</span> $search<span class="token operator">:</span> <span class="token string">&quot;programmer family diary drink&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 希望不查找出来有drink这个单词的记录，我们可以使用“-”减号来取消。</span>
db<span class="token punctuation">.</span>info<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> $text<span class="token operator">:</span> <span class="token punctuation">{</span> $search<span class="token operator">:</span> <span class="token string">&quot;programmer family diary -drink&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong>转义符：</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 全文搜索中是支持转义符的，比如我们想搜索的是两个词（love PlayGame和drink），这时候需要使用\斜杠来转意。</span>

db<span class="token punctuation">.</span>info<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> $text<span class="token operator">:</span> <span class="token punctuation">{</span> $search<span class="token operator">:</span> <span class="token string">&quot;\&quot;love PlayGame\&quot; drink&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h2 id="第19节：管理-用户的创建、删除与修改"><a href="#第19节：管理-用户的创建、删除与修改" class="header-anchor">#</a> 第19节：管理:用户的创建、删除与修改</h2> <ul><li><p><strong>创建用户：</strong></p> <p>首先要进入我们的<code>admin</code>库中，进入方法是直接使用<code>use admin</code>就可以。进入后可以使用<code>show collections</code>来查看数据库中的集合。默认是只有一个集合的<code>（system.version）</code>。</p> <ul><li>语法： <code>db.createUser()</code></li> <li>展示代码：</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 创建用户权限</span>
db<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  
  user<span class="token operator">:</span> <span class="token string">&quot;marlon&quot;</span><span class="token punctuation">,</span>  
  pwd<span class="token operator">:</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span>  
  customData<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'marlon'</span><span class="token punctuation">,</span>
    email<span class="token operator">:</span> <span class="token string">'marlon@126.com'</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  roles<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'read'</span><span class="token punctuation">]</span>  
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// or</span>
<span class="token comment">// 单独配置一个数据库的权限，比如我们现在要配置compay数据库的权限为读写</span>
db<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  
  user<span class="token operator">:</span> <span class="token string">&quot;jspang&quot;</span><span class="token punctuation">,</span>  
  pwd<span class="token operator">:</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span>  
  customData<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'技术胖'</span><span class="token punctuation">,</span>
    email<span class="token operator">:</span> <span class="token string">'web0432@126.com'</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  roles<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      role<span class="token operator">:</span> <span class="token string">&quot;readWrite&quot;</span><span class="token punctuation">,</span>
      db<span class="token operator">:</span> <span class="token string">&quot;company&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'read'</span>
  <span class="token punctuation">]</span>  
<span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token comment">/**
内置角色：
  数据库用户角色：read、readWrite；
  数据库管理角色：dbAdmin、dbOwner、userAdmin;
  集群管理角色：clusterAdmin、clusterManager、clusterMonitor、hostManage；
  备份恢复角色：backup、restore；
  所有数据库角色：readAnyDatabase、readWriteAnyDatabase、userAdminAnyDatabase、dbAdminAnyDatabase
  超级用户角色：root
  内部角色：__system
 */</span>
</code></pre></div><ul><li>数据库内置角色配置说明：
<ol><li>数据库用户角色：read、readWrite；</li> <li>数据库管理角色：dbAdmin、dbOwner、userAdmin;</li> <li>集群管理角色：clusterAdmin、clusterManager、clusterMonitor、hostManage；</li> <li>备份恢复角色：backup、restore；</li> <li>所有数据库角色：readAnyDatabase、readWriteAnyDatabase、userAdminAnyDatabase、dbAdminAnyDatabase</li> <li>超级用户角色：root</li> <li>内部角色：__system</li></ol></li></ul></li> <li><p><strong>查找用户信息</strong> <code>db.system.users.find()</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 查找用户信息</span>
db<span class="token punctuation">.</span>system<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong>删除用户</strong> <code>db.system.users.remove({ user: &quot;marlon&quot; })</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 删除用户</span>
db<span class="token punctuation">.</span>system<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">{</span> user<span class="token operator">:</span> <span class="token string">&quot;marlon&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong>鉴权</strong> <code>db.auth(name, pwd)</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 验证用户的用户名密码是否正确，就需要用到MongoDB提供的鉴权操作。也算是一种登录操作</span>

db<span class="token punctuation">.</span><span class="token function">auth</span><span class="token punctuation">(</span><span class="token string">&quot;jspang&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// 正确返回1，如果错误返回0。（Error：Authentication failed。）</span>
</code></pre></div></li> <li><p><strong>启动建权</strong> <code>mongod --auth</code></p> <p>重启MongoDB服务器，然后设置必须使用鉴权登录。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// cmd 重新启动</span>

mongod <span class="token operator">--</span>auth
</code></pre></div></li> <li><p><strong>登录</strong> <code>mongo -u jspang -p 123456 127.0.0.1:27017/admin</code></p> <p>如果在配置用户之后，用户想登录，可以使用mongo的形式，不过需要配置用户名密码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>mongo  <span class="token operator">-</span>u jspang <span class="token operator">-</span>p <span class="token number">123456</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">27017</span><span class="token operator">/</span>admin
</code></pre></div></li></ul> <h2 id="第20节：管理：备份和还原"><a href="#第20节：管理：备份和还原" class="header-anchor">#</a> 第20节：管理：备份和还原</h2> <ul><li><p>对数据库的备份和还原: <code>mongodump</code>和<code>mongorestore</code>两个命令</p></li> <li><p><strong>备份<code>mongodump</code></strong></p> <ul><li><p>mongodump备份的基本格式</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>mongodump
    <span class="token operator">--</span>host <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>
    <span class="token operator">--</span>port <span class="token number">27017</span>
    <span class="token operator">--</span>out <span class="token constant">D</span><span class="token operator">:</span><span class="token operator">/</span>databack<span class="token operator">/</span>backup   <span class="token comment">// 备份地址</span>
    <span class="token operator">--</span>collection myCollections
    <span class="token operator">--</span>db test
    <span class="token operator">--</span>username username
    <span class="token operator">--</span>password password
</code></pre></div></li> <li><p>备份演示：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>mongodump <span class="token operator">--</span>host <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span> <span class="token operator">--</span>port <span class="token number">27017</span> <span class="token operator">--</span>out <span class="token constant">D</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">databack</span><span class="token regex-delimiter">/</span></span>
</code></pre></div></li></ul></li> <li><p><strong>数据恢复<code>mongorestore</code></strong></p> <ul><li><p>mongorestore恢复基本格式</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>mongorestore
    <span class="token operator">--</span>host <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>
    <span class="token operator">--</span>port <span class="token number">27017</span>
    <span class="token operator">--</span>username username
    <span class="token operator">--</span>password password
    <span class="token operator">&lt;</span>path to the backup<span class="token operator">&gt;</span>
</code></pre></div></li> <li><p>恢复演示</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>mongorestore <span class="token operator">--</span>host <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span> <span class="token operator">--</span>port <span class="token number">27017</span> <span class="token constant">D</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">databack</span><span class="token regex-delimiter">/</span></span>
</code></pre></div></li></ul></li> <li><p>两个命令很简单，甚至你可以写成脚本和定时任务，让他每天自己执行。但是如果你真的使用了MongoDB数据库，这是一个最基本的操作。</p></li></ul> <h2 id="第21节：管理：图形界面管理（完结）"><a href="#第21节：管理：图形界面管理（完结）" class="header-anchor">#</a> 第21节：管理：图形界面管理（完结）</h2> <ul><li><code>NoSQL Manager for MongoDB</code></li> <li><code>Studio 3T</code></li> <li><code>MongoDB Compass</code></li></ul></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">3/12/2021, 9:51:50 AM</span></div></div> <!----> </div> <!----></div></div>
    <script src="/Blog/assets/js/app.2159d4b3.js" defer></script><script src="/Blog/assets/js/2.14622190.js" defer></script><script src="/Blog/assets/js/23.4b30007b.js" defer></script>
  </body>
</html>
