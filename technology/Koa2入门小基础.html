<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Koa2入门小基础 | mengjie前端开发</title>
    <meta name="description" content="一个努力的码农">
    <link rel="icon" type="image/x-icon" href="/Blog/img/icon.png">
    
    <link rel="preload" href="/Blog/assets/css/0.styles.edd67a01.css" as="style"><link rel="preload" href="/Blog/assets/js/app.2159d4b3.js" as="script"><link rel="preload" href="/Blog/assets/js/2.14622190.js" as="script"><link rel="preload" href="/Blog/assets/js/22.89979eda.js" as="script"><link rel="prefetch" href="/Blog/assets/js/10.6a93ff19.js"><link rel="prefetch" href="/Blog/assets/js/11.c47f1757.js"><link rel="prefetch" href="/Blog/assets/js/12.73863227.js"><link rel="prefetch" href="/Blog/assets/js/13.80522e4d.js"><link rel="prefetch" href="/Blog/assets/js/14.68a4f5c6.js"><link rel="prefetch" href="/Blog/assets/js/15.ec00eb3a.js"><link rel="prefetch" href="/Blog/assets/js/16.f582d6c1.js"><link rel="prefetch" href="/Blog/assets/js/17.7b213757.js"><link rel="prefetch" href="/Blog/assets/js/18.b03270d5.js"><link rel="prefetch" href="/Blog/assets/js/19.e05d7c48.js"><link rel="prefetch" href="/Blog/assets/js/20.1bb272e3.js"><link rel="prefetch" href="/Blog/assets/js/21.5777fedf.js"><link rel="prefetch" href="/Blog/assets/js/23.4b30007b.js"><link rel="prefetch" href="/Blog/assets/js/24.08c605af.js"><link rel="prefetch" href="/Blog/assets/js/25.3d0a8a58.js"><link rel="prefetch" href="/Blog/assets/js/26.07c0104b.js"><link rel="prefetch" href="/Blog/assets/js/27.24dfab8b.js"><link rel="prefetch" href="/Blog/assets/js/28.46f1bcdc.js"><link rel="prefetch" href="/Blog/assets/js/29.6dc6d7de.js"><link rel="prefetch" href="/Blog/assets/js/3.6c3dee68.js"><link rel="prefetch" href="/Blog/assets/js/30.dcce14df.js"><link rel="prefetch" href="/Blog/assets/js/4.8f84f249.js"><link rel="prefetch" href="/Blog/assets/js/5.236c83d5.js"><link rel="prefetch" href="/Blog/assets/js/6.ce0a3d40.js"><link rel="prefetch" href="/Blog/assets/js/7.44a5767d.js"><link rel="prefetch" href="/Blog/assets/js/8.e33d5460.js"><link rel="prefetch" href="/Blog/assets/js/9.102fdc46.js">
    <link rel="stylesheet" href="/Blog/assets/css/0.styles.edd67a01.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Blog/" class="home-link router-link-active"><img src="/Blog/img/logo.png" alt="mengjie前端开发" class="logo"> <span class="site-name can-hide">mengjie前端开发</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Blog/timeLine/" class="nav-link">首页</a></div><div class="nav-item"><a href="/Blog/technology/" class="nav-link router-link-active">技术</a></div><div class="nav-item"><a href="/Blog/essay/" class="nav-link">随笔</a></div><div class="nav-item"><a href="/Blog/ponder/" class="nav-link">思考</a></div><div class="nav-item"><a href="/Blog/others/" class="nav-link">其他</a></div><div class="nav-item"><a href="/Blog/tags/" class="nav-link">标签</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">链接</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/mengjie0611" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://es6.ruanyifeng.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ES6入门
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav> <div class="mp3-player" data-v-172d32ba>
  音乐
  <div role="switch" class="el-switch" data-v-172d32ba><input type="checkbox" name="" true-value="true" class="el-switch__input"><!----><span class="el-switch__core" style="width:40px;"></span><!----></div> <audio loop="loop" data-v-172d32ba><source src="/Blog/assets/media/7 Years - Lukas Graham.e8dd8397.mp3" type="audio/mpeg" data-v-172d32ba></audio></div></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Blog/timeLine/" class="nav-link">首页</a></div><div class="nav-item"><a href="/Blog/technology/" class="nav-link router-link-active">技术</a></div><div class="nav-item"><a href="/Blog/essay/" class="nav-link">随笔</a></div><div class="nav-item"><a href="/Blog/ponder/" class="nav-link">思考</a></div><div class="nav-item"><a href="/Blog/others/" class="nav-link">其他</a></div><div class="nav-item"><a href="/Blog/tags/" class="nav-link">标签</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">链接</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/mengjie0611" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://es6.ruanyifeng.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ES6入门
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Koa2入门小基础</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Blog/technology/Koa2%E5%85%A5%E9%97%A8%E5%B0%8F%E5%9F%BA%E7%A1%80.html#第01节：koa开发环境搭建" class="sidebar-link">第01节：Koa开发环境搭建</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Blog/technology/Koa2%E5%85%A5%E9%97%A8%E5%B0%8F%E5%9F%BA%E7%A1%80.html#搭建环境" class="sidebar-link">搭建环境</a></li><li class="sidebar-sub-header"><a href="/Blog/technology/Koa2%E5%85%A5%E9%97%A8%E5%B0%8F%E5%9F%BA%E7%A1%80.html#与君初相识" class="sidebar-link">与君初相识</a></li></ul></li><li><a href="/Blog/technology/Koa2%E5%85%A5%E9%97%A8%E5%B0%8F%E5%9F%BA%E7%A1%80.html#第02节：async-await的使用方法" class="sidebar-link">第02节：async/await的使用方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Blog/technology/Koa2%E5%85%A5%E9%97%A8%E5%B0%8F%E5%9F%BA%E7%A1%80.html#什么是async和await" class="sidebar-link">什么是async和await</a></li><li class="sidebar-sub-header"><a href="/Blog/technology/Koa2%E5%85%A5%E9%97%A8%E5%B0%8F%E5%9F%BA%E7%A1%80.html#async-await同时使用" class="sidebar-link">async/await同时使用</a></li></ul></li><li><a href="/Blog/technology/Koa2%E5%85%A5%E9%97%A8%E5%B0%8F%E5%9F%BA%E7%A1%80.html#第03节：get请求的接收" class="sidebar-link">第03节：Get请求的接收</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Blog/technology/Koa2%E5%85%A5%E9%97%A8%E5%B0%8F%E5%9F%BA%E7%A1%80.html#第04节：post请求如何接收（1）" class="sidebar-link">第04节：POST请求如何接收（1）</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Blog/technology/Koa2%E5%85%A5%E9%97%A8%E5%B0%8F%E5%9F%BA%E7%A1%80.html#第05节：post请求如何接收（2）" class="sidebar-link">第05节：POST请求如何接收（2）</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Blog/technology/Koa2%E5%85%A5%E9%97%A8%E5%B0%8F%E5%9F%BA%E7%A1%80.html#扩展-array-entries方法精讲" class="sidebar-link">[扩展]Array/entries方法精讲</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Blog/technology/Koa2%E5%85%A5%E9%97%A8%E5%B0%8F%E5%9F%BA%E7%A1%80.html#第06节：koa-bodyparser中间件" class="sidebar-link">第06节：koa-bodyparser中间件</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Blog/technology/Koa2%E5%85%A5%E9%97%A8%E5%B0%8F%E5%9F%BA%E7%A1%80.html#第07节：koa2原生路由实现" class="sidebar-link">第07节：Koa2原生路由实现</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Blog/technology/Koa2%E5%85%A5%E9%97%A8%E5%B0%8F%E5%9F%BA%E7%A1%80.html#第08节：koa-router中间件（1）入门" class="sidebar-link">第08节：Koa-router中间件（1）入门</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Blog/technology/Koa2%E5%85%A5%E9%97%A8%E5%B0%8F%E5%9F%BA%E7%A1%80.html#第09节：koa-router中间件（2）层级" class="sidebar-link">第09节：Koa-router中间件（2）层级</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Blog/technology/Koa2%E5%85%A5%E9%97%A8%E5%B0%8F%E5%9F%BA%E7%A1%80.html#第10节：koa-router中间件（3）参数" class="sidebar-link">第10节：Koa-router中间件（3）参数</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Blog/technology/Koa2%E5%85%A5%E9%97%A8%E5%B0%8F%E5%9F%BA%E7%A1%80.html#第11节：koa2中使用cookie" class="sidebar-link">第11节：Koa2中使用cookie</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Blog/technology/Koa2%E5%85%A5%E9%97%A8%E5%B0%8F%E5%9F%BA%E7%A1%80.html#第12节：koa2的模板初识（ejs）" class="sidebar-link">第12节：Koa2的模板初识（ejs）</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Blog/technology/Koa2%E5%85%A5%E9%97%A8%E5%B0%8F%E5%9F%BA%E7%A1%80.html#第13节：koa-static静态资源中间件" class="sidebar-link">第13节：koa-static静态资源中间件</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="koa2入门小基础"><a href="#koa2入门小基础" class="header-anchor">#</a> Koa2入门小基础</h1> <p>学习指导：<a href="http://www.jspang.com/posts/2017/11/13/koa2.html" target="_blank" rel="noopener noreferrer">挑战全栈 Koa2免费视频教程 (共13集)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>Koa2是现在最流行的基于Node.js平台的web开发框架，它很小，但扩展性很强。Koa给人一种干净利落的感觉，体积小、编程方式干净。</p> <blockquote><p>使用 koa 编写 web 应用，通过组合不同的 generator，可以免除重复繁琐的回调函数嵌套，并极大地提升错误处理的效率。一个Koa应用就是一个对象，包含了一个middleware数组，这个数组由一组Generator函数组成。这些函数负责对HTTP请求进行各种加工，比如生成缓存、指定代理、请求重定向等等。这些中间件函数基于 request 请求以一个类似于栈的结构组成并依次执行。</p></blockquote> <h2 id="第01节：koa开发环境搭建"><a href="#第01节：koa开发环境搭建" class="header-anchor">#</a> 第01节：Koa开发环境搭建</h2> <p>作Koa2的开发，它要求Node.js版本高于V7.6。</p> <blockquote><div class="warning custom-block"><p class="custom-block-title">注意事项</p> <p>请确保你的 Node.js 版本 &gt;= 7.6。</p></div></blockquote> <h3 id="搭建环境"><a href="#搭建环境" class="header-anchor">#</a> 搭建环境</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> code  //进入code文件夹
<span class="token function">mkdir</span> koa2-demo //创建koa2-demo文件夹
<span class="token builtin class-name">cd</span> koa2-demo  //进入koa2-demo文件夹

<span class="token function">npm</span> init -y // 初始化生产package.json 文件
<span class="token function">npm</span> <span class="token function">install</span> --save koa // 安装koa
</code></pre></div><h3 id="与君初相识"><a href="#与君初相识" class="header-anchor">#</a> 与君初相识</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 根目录下创建 index.js</span>

<span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'Hello Koa2'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'[demo] start-quick is starting at port 3000'</span><span class="token punctuation">)</span>

<span class="token comment">// 运行 node index.js</span>
<span class="token comment">// 浏览器中输入：http://127.0.0.1:3000 就可以看到结果了</span>
</code></pre></div><h2 id="第02节：async-await的使用方法"><a href="#第02节：async-await的使用方法" class="header-anchor">#</a> 第02节：async/await的使用方法</h2> <h3 id="什么是async和await"><a href="#什么是async和await" class="header-anchor">#</a> 什么是async和await</h3> <p>async是异步的简写，而await可以堪称async wait的简写。</p> <p>明白了两个单词，就很好理解了async是声明一个方法是异步的，await是等待异步方法完成。</p> <p>注意的是await必须在async方法中才可以使用因为await访问本身就会造成程序停止堵塞，所以必须在异步方法中才可以使用。</p> <ul><li><p><strong>async到底起什么作用</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// async是让方法变成异步，这个很好理解，关键是他的返回值是什么？我们得到后如何处理？</span>

<span class="token comment">// ./demo01.js</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">testAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'Hello Async'</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">testAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>  <span class="token comment">// Promise { 'Hello Async' }</span>

<span class="token comment">// 输出了Promise { ‘Hello Async’ }，这时候会发现它返回的是Promise</span>
</code></pre></div></li> <li><p><strong>await在等什么？</strong></p> <p>await一般在等待async方法执行完毕，但是其实await等待的只是一个表达式，这个表达式在官方文档里说的是Promise对象，可是它也可以接受普通值。</p> <p><strong>await必须在async方法中才可以使用</strong></p> <p><strong>await接收Promise对象，也可以接收普通值</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ./demo02.js</span>

<span class="token keyword">function</span> <span class="token function">getSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'something'</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">testAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'Hello Async'</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> res1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> res2 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">testAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res1<span class="token punctuation">,</span> res2<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 执行</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// something Hello Async</span>
</code></pre></div></li></ul> <h3 id="async-await同时使用"><a href="#async-await同时使用" class="header-anchor">#</a> async/await同时使用</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ./demo03.js</span>

<span class="token keyword">function</span> <span class="token function">takeLongTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'long_time_value'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">takeLongTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 等待2秒钟， 输出 long_time_value</span>
</code></pre></div><h2 id="第03节：get请求的接收"><a href="#第03节：get请求的接收" class="header-anchor">#</a> 第03节：Get请求的接收</h2> <ul><li><p>在koa2中GET请求通过request接收，但是接受的方法有两种：query和querystring。</p> <ul><li>query：返回的是格式化好的参数对象。</li> <li>querystring：返回的是请求字符串。</li></ul></li> <li><p>从 <code>ctx.request</code> 中获取Get请求</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/**
 *  在koa2中GET请求通过request接收，但是接受的方法有两种：query和querystring。
 *  query：返回的是格式化好的参数对象。
 *  querystring：返回的是请求字符串。
 */</span>

<span class="token comment">// ./ get_demo.js</span>

<span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 上下文得到url对象</span>
    <span class="token keyword">let</span> url <span class="token operator">=</span> ctx<span class="token punctuation">.</span>url
    <span class="token keyword">let</span> request <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request
    <span class="token keyword">let</span> req_query <span class="token operator">=</span> request<span class="token punctuation">.</span>query
    <span class="token keyword">let</span> req_querystring <span class="token operator">=</span> request<span class="token punctuation">.</span>querystring
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
        url<span class="token punctuation">,</span>
        req_query<span class="token punctuation">,</span>
        req_querystring
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'[demo] server is starting at port 3000'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 启动一切正常可在浏览器中使用http://127.0.0.1:3000?user=jspang&amp;age=18来进行访问</span>
<span class="token comment">// {&quot;url&quot;:&quot;/?user=jspang&amp;age=18&quot;,&quot;req_query&quot;:{&quot;user&quot;:&quot;jspang&quot;,&quot;age&quot;:&quot;18&quot;},&quot;req_querystring&quot;:&quot;user=jspang&amp;age=18&quot;}</span>
<span class="token comment">// query是一个对象，而querystring就是一个普通的字符串。</span>
</code></pre></div></li> <li><p>从<code>ctx</code>中得到GET请求。<code>ctx</code>中也分为query和querystring</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 从ctx中得到GET请求。ctx中也分为query和querystring</span>

<span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//从request中获取GET请求</span>
    <span class="token comment">// 上下文得到url对象</span>
    <span class="token keyword">let</span> url <span class="token operator">=</span> ctx<span class="token punctuation">.</span>url
    <span class="token keyword">let</span> request <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request
    <span class="token keyword">let</span> req_query <span class="token operator">=</span> request<span class="token punctuation">.</span>query
    <span class="token keyword">let</span> req_querystring <span class="token operator">=</span> request<span class="token punctuation">.</span>querystring

    <span class="token comment">//从上下文中直接获取</span>
    <span class="token keyword">let</span> ctx_query <span class="token operator">=</span> ctx<span class="token punctuation">.</span>query
    <span class="token keyword">let</span> ctx_querystring <span class="token operator">=</span> ctx<span class="token punctuation">.</span>querystring

    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
        url<span class="token punctuation">,</span>
        req_query<span class="token punctuation">,</span>
        req_querystring<span class="token punctuation">,</span>
        ctx_query<span class="token punctuation">,</span>
        ctx_querystring
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'[demo] server is starting at port 3000'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">/**
 // 20190813114559
// http://127.0.0.1:3000/?user=jspang&amp;age=18

{
  &quot;url&quot;: &quot;/?user=jspang&amp;age=18&quot;,
  &quot;req_query&quot;: {
    &quot;user&quot;: &quot;jspang&quot;,
    &quot;age&quot;: &quot;18&quot;
  },
  &quot;req_querystring&quot;: &quot;user=jspang&amp;age=18&quot;,
  &quot;ctx_query&quot;: {
    &quot;user&quot;: &quot;jspang&quot;,
    &quot;age&quot;: &quot;18&quot;
  },
  &quot;ctx_querystring&quot;: &quot;user=jspang&amp;age=18&quot;
}

* */</span>
</code></pre></div></li> <li><p>总结：获得GET请求的方式有两种，一种是从request中获得，一种是一直从上下文中获得。</p></li> <li><p>获得的格式也有两种：query和querystring。</p></li></ul> <h2 id="第04节：post请求如何接收（1）"><a href="#第04节：post请求如何接收（1）" class="header-anchor">#</a> 第04节：POST请求如何接收（1）</h2> <ul><li><p>对于POST请求的处理，Koa2没有封装方便的获取参数的方法，需要通过解析上下文context中的原生node.js请求对象req来获取。</p></li> <li><p><strong>获取Post请求的步骤：</strong></p></li></ul> <ol><li>解析上下文ctx中的原生nodex.js对象req。</li> <li>将POST表单数据解析成query string-字符串.(例如:user=jspang&amp;age=18)</li> <li>将字符串转换成JSON格式。</li></ol> <ul><li><strong>ctx.request和ctx.req的区别</strong></li></ul> <ol><li>ctx.request: 是Koa2中context经过封装的请求对象，它用起来更直观和简单。</li> <li>ctx.req: 是context提供的node.js原生HTTP请求对象。这个虽然不那么直观，但是可以得到更多的内容，适合我们深度编程。</li></ol> <ul><li><p><strong>ctx.method 得到请求类型</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ctx.method 得到请求类型</span>

<span class="token comment">// Koa2中提供了ctx.method属性，可以轻松的得到请求的类型，</span>
<span class="token comment">// 然后根据请求类型编写不同的相应方法</span>

<span class="token comment">// ./post_demo01.js</span>

<span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 当请求是GET请求，显示表单让用户填写</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>url <span class="token operator">===</span> <span class="token string">'/'</span> <span class="token operator">&amp;&amp;</span> ctx<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">'GET'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> html <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
      &lt;h1&gt;Koa2 request post demo&lt;/h1&gt;
      &lt;form method='POST' action='/'&gt;
      &lt;p&gt;userName&lt;/p&gt;
        &lt;input name=&quot;userName&quot;/&gt; &lt;br/&gt;
        &lt;p&gt;age&lt;/p&gt;
        &lt;input name=&quot;age&quot;/&gt; &lt;br/&gt;
        &lt;p&gt;webSite&lt;/p&gt;
        &lt;input name='webSite'/&gt;&lt;br/&gt;
        &lt;button type=&quot;submit&quot;&gt;submit&lt;/button&gt;
      &lt;/form&gt;
    </span><span class="token template-punctuation string">`</span></span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> html
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>url <span class="token operator">===</span> <span class="token string">'/'</span> <span class="token operator">&amp;&amp;</span> ctx<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">'POST'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 当请求时POST请求时</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'接收到请求'</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token comment">// 其他请求显示404报错</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'&lt;h1&gt;404 page!&lt;/h1&gt;'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'[demo] server is starting at port 3000'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">/**
浏览器中输入http://127.0.0.1:3000进行查看，
  第一次进入时给我们展现的是一个表单页面，
  我们点击提交后可以看到服务器接收到了我们的信息，但我们并没有做出任何处理。
  当我们下输入一个地址时，它会提示404错误。
* */</span>

<span class="token comment">// **总结：**从理论上讲解了如何获取POST请求参数</span>
</code></pre></div></li></ul> <h2 id="第05节：post请求如何接收（2）"><a href="#第05节：post请求如何接收（2）" class="header-anchor">#</a> 第05节：POST请求如何接收（2）</h2> <ul><li><p><strong>解析Node原生POST参数</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ./post_demo2.js</span>

<span class="token comment">// 解析Node原生POST参数</span>
<span class="token comment">// 声明一个方法，然后用Promise对象进行解析。这里我们使用了ctx.req.on来接收事件</span>
<span class="token keyword">function</span> <span class="token function">parsePostData</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> postdata <span class="token operator">=</span> <span class="token string">''</span>
      ctx<span class="token punctuation">.</span>req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        postdata <span class="token operator">+=</span> data
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      ctx<span class="token punctuation">.</span>req<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>postdata<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>修改在上节课接收POST请求的处理方法里，修改代码如下</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ctx.body = '接收到POST请求'</span>
<span class="token keyword">let</span> postdata <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">parsePostData</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>  <span class="token comment">// userName=jspang&amp;age=123&amp;webSite=www.douban.com</span>
ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> postdata

<span class="token comment">// 页面就输出刚才填的表单  userName=jspang&amp;age=123&amp;webSite=www.douban.com</span>
</code></pre></div></li> <li><p><strong>POST字符串解析JSON对象</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ./post_demo2.js</span>

<span class="token comment">// POST字符串解析JSON对象</span>
<span class="token comment">// 字符串封装JSON兑现对象的方法</span>
<span class="token comment">// userName=jspang&amp;age=123&amp;webSite=www.douban.com</span>
<span class="token keyword">function</span> <span class="token function">parseQueryStr</span><span class="token punctuation">(</span><span class="token parameter">queryStr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> queryData <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token comment">// split() 方法使用指定的分隔符字符串将一个String对象分割成字符串数组，</span>
  <span class="token comment">// 以将字符串分隔为子字符串，以确定每个拆分的位置。 </span>
  <span class="token keyword">let</span> queryStrList <span class="token operator">=</span> queryStr<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'&amp;'</span><span class="token punctuation">)</span>
  <span class="token comment">// console.log(queryStrList)</span>
  <span class="token comment">// entries() 方法返回一个新的Array Iterator对象，该对象包含数组中每个索引的键/值对</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>index<span class="token punctuation">,</span> queryStrItem<span class="token punctuation">]</span> <span class="token keyword">of</span> queryStrList<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> itemList <span class="token operator">=</span> queryStrItem<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span>
    <span class="token comment">// console.log(itemList)</span>
    queryData<span class="token punctuation">[</span>itemList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> itemList<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> queryData
<span class="token punctuation">}</span>


<span class="token comment">// 在上述解析Node原生POST参数中修改</span>
ctx<span class="token punctuation">.</span>req<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// resolve(postdata)</span>
    <span class="token keyword">let</span> parseData <span class="token operator">=</span> <span class="token function">parseQueryStr</span><span class="token punctuation">(</span>postdata<span class="token punctuation">)</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>parseData<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">/**
使用for…of 循环
var arr = [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;];
var iterator = arr.entries();

for (let e of iterator) {
  console.log(e);
}

// [0, &quot;a&quot;] 
// [1, &quot;b&quot;] 
// [2, &quot;c&quot;]
*/</span>

<span class="token comment">// node运行，浏览器http://127.0.0.1:3000，先填写表单，然后页面就会返回</span>
<span class="token comment">/*
{
  &quot;userName&quot;: &quot;jspang&quot;,
  &quot;age&quot;: &quot;123&quot;,
  &quot;webSite&quot;: &quot;www.douban.com&quot;
}
*/</span>
</code></pre></div></li> <li><p>完整代码见<code>post_demo2.js</code></p></li></ul> <h2 id="扩展-array-entries方法精讲"><a href="#扩展-array-entries方法精讲" class="header-anchor">#</a> [扩展]Array/entries方法精讲</h2> <ul><li><p>参考：<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/entries" target="_blank" rel="noopener noreferrer">Array/entries<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><code>**entries()**</code> 方法返回一个新的<strong>Array Iterator</strong>对象，该对象包含数组中每个索引的键/值对。</p></li> <li><blockquote><p>arr.entries()</p></blockquote> <p>返回值是 一个新的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Array" target="_blank" rel="noopener noreferrer"><code>Array</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 迭代器对象。<a href="http://www.ecma-international.org/ecma-262/6.0/#sec-createarrayiterator" target="_blank" rel="noopener noreferrer">Array Iterator<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是对象，它的原型（<strong>proto</strong>:Array Iterator）上有一个<a href="http://www.ecma-international.org/ecma-262/6.0/#sec-%25arrayiteratorprototype%25.next" target="_blank" rel="noopener noreferrer">next<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>方法，可用用于遍历迭代器取得原数组的[key,value]。</p></li> <li><p><code>Array Iterator</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;c&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> iterator <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iterator<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*Array Iterator {}
         __proto__:Array Iterator
         next:ƒ next()
         Symbol(Symbol.toStringTag):&quot;Array Iterator&quot;
         __proto__:Object
*/</span>
</code></pre></div></li> <li><p><code>iterator.next()</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;c&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">var</span> iterator <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*{value: Array(2), done: false}
          done:false
          value:(2) [0, &quot;a&quot;]
           __proto__: Object
*/</span>
<span class="token comment">// iterator.next()返回一个对象，对于有元素的数组，</span>
<span class="token comment">// 是next{ value: Array(2), done: false }；</span>
<span class="token comment">// next.done 用于指示迭代器是否完成：在每次迭代时进行更新而且都是false，</span>
<span class="token comment">// 直到迭代器结束done才是true。</span>
<span class="token comment">// next.value是一个[&quot;key&quot;,&quot;value&quot;]的数组，是返回的迭代器中的元素值。</span>
</code></pre></div></li> <li><p><code>iterator.next方法运行</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;c&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> iter <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// for(var i=0; i&lt; arr.length; i++){   // 实际使用的是这个 </span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment">// 注意，是length+1，比数组的长度大</span>
    <span class="token keyword">var</span> tem <span class="token operator">=</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// 每次迭代时更新next</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tem<span class="token punctuation">.</span>done<span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// 这里可以看到更新后的done都是false</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>tem<span class="token punctuation">.</span>done <span class="token operator">!==</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>             <span class="token comment">// 遍历迭代器结束done才是true</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tem<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>tem<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>                         <span class="token comment">// 遍历完毕，输出next.value的数组</span>
</code></pre></div></li> <li><p><code>二维数组按行排序</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">sortArr</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> goNext <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> entries <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>goNext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> result <span class="token operator">=</span> entries<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>done <span class="token operator">!==</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            result<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">-</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
            goNext <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            goNext <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> arr<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">34</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">456</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">44</span><span class="token punctuation">,</span><span class="token number">234</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4567</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">34</span><span class="token punctuation">,</span><span class="token number">78</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">sortArr</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*(4) [Array(2), Array(5), Array(5), Array(4)]
    0:(2) [1, 34]
    1:(5) [2, 3, 44, 234, 456]
    2:(5) [1, 4, 5, 6, 4567]
    3:(4) [1, 23, 34, 78]
    length:4
    __proto__:Array(0)
*/</span>
</code></pre></div></li> <li><p><code>使用for…of 循环</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;c&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> iterator <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// undefined</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> e <span class="token keyword">of</span> iterator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// [0, &quot;a&quot;]</span>
<span class="token comment">// [1, &quot;b&quot;]</span>
<span class="token comment">// [2, &quot;c&quot;]</span>
</code></pre></div></li></ul> <h2 id="第06节：koa-bodyparser中间件"><a href="#第06节：koa-bodyparser中间件" class="header-anchor">#</a> 第06节：koa-bodyparser中间件</h2> <p>对于POST请求的处理，koa-bodyparser中间件可以把koa2上下文的formData数据解析到ctx.request.body中。</p> <ul><li><p><strong>安装中间件</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 使用npm进行安装，需要注意的是我们这里要用–save，因为它在生产环境中需要使用。</span>

<span class="token function">npm</span> <span class="token function">install</span> --save koa-bodyparser@3
</code></pre></div></li> <li><p><strong>引入使用</strong></p> <p>安装完成后，需要在代码中引入并使用。我们在代码顶部用require进行引入。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-bodyparser'</span><span class="token punctuation">)</span>
</code></pre></div><p>然后进行使用，如果不使用是没办法调用的，使用代码如下。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">bodyParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>在代码中使用后，直接可以用<code>ctx.request.body</code>进行获取POST请求参数，中间件自动给我们作了解析。</p></li> <li><p>用例：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Post请求解析中间件   koa-bodyparser</span>

<span class="token comment">// ./bodyparser_demo.js</span>

<span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-bodyparser'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">bodyParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 当请求是GET请求，显示表单让用户填写</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>url <span class="token operator">===</span> <span class="token string">'/'</span> <span class="token operator">&amp;&amp;</span> ctx<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">'GET'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> html <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
      &lt;h1&gt;Koa2 request post demo&lt;/h1&gt;
      &lt;form method='POST' action='/'&gt;
      &lt;p&gt;userName&lt;/p&gt;
        &lt;input name=&quot;userName&quot;/&gt; &lt;br/&gt;
        &lt;p&gt;age&lt;/p&gt;
        &lt;input name=&quot;age&quot;/&gt; &lt;br/&gt;
        &lt;p&gt;webSite&lt;/p&gt;
        &lt;input name='webSite'/&gt;&lt;br/&gt;
        &lt;button type=&quot;submit&quot;&gt;submit&lt;/button&gt;
      &lt;/form&gt;
    </span><span class="token template-punctuation string">`</span></span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> html
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>url <span class="token operator">===</span> <span class="token string">'/'</span> <span class="token operator">&amp;&amp;</span> ctx<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">'POST'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 当请求时POST请求时</span>
    <span class="token comment">// ctx.body = '接收到POST请求'</span>
    <span class="token keyword">let</span> postData<span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> postData
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token comment">// 其他请求显示404报错</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'&lt;h1&gt;404 page!&lt;/h1&gt;'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'[demo] server is starting at port 3000'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h2 id="第07节：koa2原生路由实现"><a href="#第07节：koa2原生路由实现" class="header-anchor">#</a> 第07节：Koa2原生路由实现</h2> <ul><li><p><code>ctx.request.url</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ctx.request.url</span>
<span class="token comment">// 地址栏输入的路径，然后根据路径的不同进行跳转</span>

<span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> url <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> url
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'[demo] server is starting at port 3000'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 访问http://127.0.0.1:3000/jspang/18 页面会输出/jspang/18</span>
</code></pre></div></li> <li><p><strong>Koa2原生路由实现</strong></p> <p>原生路由的实现需要引入fs模块来读取文件。然后再根据路由的路径去读取，最后返回给页面，进行渲染。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Koa2原生路由实现</span>

<span class="token comment">// ctx.request.url</span>
<span class="token comment">// 地址栏输入的路径，然后根据路径的不同进行跳转</span>

<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">page</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> pageUrl <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./page/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>page<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token comment">// 获取文件地址 读取文件</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>pageUrl<span class="token punctuation">,</span> <span class="token string">&quot;binary&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">route</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> page <span class="token operator">=</span> <span class="token string">'404.html'</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'/'</span><span class="token operator">:</span>
      page <span class="token operator">=</span> <span class="token string">'index.html'</span>
      <span class="token keyword">break</span>
    <span class="token keyword">case</span> <span class="token string">'/index'</span><span class="token operator">:</span>
      page <span class="token operator">=</span> <span class="token string">'index.html'</span>
      <span class="token keyword">break</span>
    <span class="token keyword">case</span> <span class="token string">'/todo'</span><span class="token operator">:</span>
      page <span class="token operator">=</span> <span class="token string">'todo.html'</span>
      <span class="token keyword">break</span>
    <span class="token keyword">case</span> <span class="token string">'/404'</span><span class="token operator">:</span>
      page <span class="token operator">=</span> <span class="token string">'404.html'</span>
      <span class="token keyword">break</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">break</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">let</span> html <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">render</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span>
  <span class="token keyword">return</span> html
<span class="token punctuation">}</span>

<span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> url <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url
  <span class="token keyword">let</span> html <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">route</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> html
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'[demo] server is starting at port 3000'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h2 id="第08节：koa-router中间件（1）入门"><a href="#第08节：koa-router中间件（1）入门" class="header-anchor">#</a> 第08节：Koa-router中间件（1）入门</h2> <p>安装koa-router中间件</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 安装koa-router中间件</span>

<span class="token function">npm</span> <span class="token function">install</span> --save koa-router
</code></pre></div><p>基础案例</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Koa-router</span>

<span class="token comment">// ./koa-router1.js</span>

<span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

router
  <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'Hello Koa-router'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/todo'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>   <span class="token comment">// 路由多页面配置</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'Todo page!'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 挂载路由</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'[demo] server is starting at port 3000'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="第09节：koa-router中间件（2）层级"><a href="#第09节：koa-router中间件（2）层级" class="header-anchor">#</a> 第09节：Koa-router中间件（2）层级</h2> <ul><li><p><strong>设置前缀</strong></p> <p>有时候我们想把所有的路径前面都再加入一个级别，比如原来我们访问的路径是<code>http://127.0.0.1:3000/todo</code>，现在我们希望在所有的路径前面都加上一个jspang层级，把路径变成<code>http://127.0.0.1:3000/jspang/todo.</code>这时候就可以使用层级来完成这个功能。路由在创建的时候是可以指定一个前缀的，这个前缀会被至于路由的最顶层，也就是说，这个路由的所有请求都是相对于这个前缀的.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    prefix<span class="token operator">:</span><span class="token string">'/jspang'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>设置层级</p> <p>设置前缀一般都是全局的，并不能实现路由的层级，如果你想为单个页面设置层级，也是很简单的。只要在use时使用路径就可以了。</p> <p>例如这种写法装载路由层级，这里的router相当于父级：<code>router.use(‘/page’, page.routes(), page.allowedMethods())</code>。</p> <p>通过这种写法的好处是并不是全局的，我们可以给不同的路由加层级。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Koa-router 层级</span>

<span class="token comment">// ./koa-router2.js</span>

<span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// const router = new Router({</span>
<span class="token comment">//   // prefix: '/jspang'  // 设置前缀</span>
<span class="token comment">// })</span>

<span class="token comment">// 设置路由层级</span>
<span class="token keyword">let</span> home <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
home
  <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/jspang'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'Home jspang'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/todo'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>   <span class="token comment">// 路由多页面配置</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'Home Todo'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> page <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
page
  <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/jspang'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token comment">// async 异步不异步都可以</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'Page jspang'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/todo'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>   <span class="token comment">// 路由多页面配置</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'Page Todo'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 装载所有子路由  router.use(‘/page’, page.routes(), page.allowedMethods())</span>
<span class="token comment">// 设置父路由</span>
<span class="token keyword">let</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
router<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/home'</span><span class="token punctuation">,</span> home<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> home<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
router<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/page'</span><span class="token punctuation">,</span> page<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> page<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 挂载路由中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'[demo] server is starting at port 3000'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h2 id="第10节：koa-router中间件（3）参数"><a href="#第10节：koa-router中间件（3）参数" class="header-anchor">#</a> 第10节：Koa-router中间件（3）参数</h2> <ul><li><p>获取传递参数 <code>ctx.query来进行接收</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Koa-router 参数</span>

<span class="token comment">// ./koa-router3.js</span>

<span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

router
  <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取 get 请求参数</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> ctx<span class="token punctuation">.</span>query
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 挂载路由中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'[demo] server is starting at port 3000'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 地址栏输出 http://127.0.0.1:3000/?user=jspang&amp;age=18</span>
<span class="token comment">/*
{
  &quot;user&quot;: &quot;jspang&quot;,
  &quot;age&quot;: &quot;18&quot;
}
*/</span>
</code></pre></div></li></ul> <h2 id="第11节：koa2中使用cookie"><a href="#第11节：koa2中使用cookie" class="header-anchor">#</a> 第11节：Koa2中使用cookie</h2> <ul><li><p><code>ctx.cookies.get(name,[optins])</code>: 读取上下文请求中的cookie。</p></li> <li><p><code>ctx.cookies.set(name,value,[options])</code>：在上下文中写入cookie</p></li> <li><p><strong>写入<code>Cookies</code></strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>ctx<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'jspang'</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong>Cookie选项</strong></p> <ul><li>比如我们要存储用户名，保留用户登录状态时，你可以选择7天内不用登录，也可以选择30天内不用登录。这就需要在写入是配置一些选项：</li> <li><code>domain</code>：写入cookie所在的域名</li> <li><code>path</code>：写入cookie所在的路径</li> <li><code>maxAge</code>：Cookie最大有效时长</li> <li><code>expires</code>：cookie失效时间</li> <li><code>httpOnly</code>:是否只用http请求中获得</li> <li><code>overwirte</code>：是否允许重写</li></ul></li> <li><p><strong>读取<code>cookies</code></strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>ctx<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h2 id="第12节：koa2的模板初识（ejs）"><a href="#第12节：koa2的模板初识（ejs）" class="header-anchor">#</a> 第12节：Koa2的模板初识（ejs）</h2> <p>开发中不可能把所有的html代码全部卸载JS里，这显然不现实，也没办法完成大型web开发。必须借用模板机制来帮助我们开发，这节课我们就简单了解一下Koa2的模板机制，koa2的目标机制要依靠中间件来完成开发。</p> <ul><li><p><strong>安装中间件</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 安装中间件</span>

<span class="token function">npm</span> <span class="token function">install</span> --save koa-views
</code></pre></div></li> <li><p><strong>安装ejs模板引擎</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 安装ejs模板引擎</span>

<span class="token function">npm</span> <span class="token function">install</span> --save ejs
</code></pre></div></li> <li><p><strong>编写模板</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 为了模板统一管理，我们新建一个view的文件夹，并在它下面新建index.ejs文件。</span>

<span class="token comment">// ./views/index.ejs</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">&quot;en&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">&quot;viewport&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">&quot;X-UA-Compatible&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;ie=edge&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">%=</span> title<span class="token operator">%</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">%=</span> title <span class="token operator">%</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token constant">EJS</span> Welcome to <span class="token operator">&lt;</span><span class="token operator">%=</span> title <span class="token operator">%</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre></div></li> <li><p><strong>编写Koa文件</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ejs模板</span>
<span class="token comment">// ./ejs_demo.js</span>

<span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> views <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-views'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 加载模板引擎</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">views</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./views'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  extension<span class="token operator">:</span> <span class="token string">'ejs'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> title <span class="token operator">=</span> <span class="token string">'HELLO Koa2'</span>
  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    title
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'[demo] server is starting at port 3000'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h2 id="第13节：koa-static静态资源中间件"><a href="#第13节：koa-static静态资源中间件" class="header-anchor">#</a> 第13节：koa-static静态资源中间件</h2> <p>在后台开发中不仅有需要代码处理的业务逻辑请求，也会有很多的静态资源请求。比如请求js，css，jpg，png这些静态资源请求。也非常的多，有些时候还会访问静态资源路径。用koa2自己些这些静态资源访问是完全可以的，但是代码会雍长一些。所以这节课我们利用koa-static中间件来实现静态资源的访问。</p> <ul><li><p>安装<code>koa-static</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save koa-static
</code></pre></div></li> <li><p><strong>新建static文件夹</strong> 然后在static文件中放入图片，css和js文件</p></li> <li><p>使用<code>koa-static</code>中间件</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token keyword">static</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-static'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 声明静态路径</span>
<span class="token keyword">const</span> staticPath <span class="token operator">=</span> <span class="token string">'./static'</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">static</span><span class="token punctuation">(</span>
    path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> staticPath<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'hello world'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'[demo] server is starting at port 3000'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 访问图片直接 http://127.0.0.1:3000/koa2.jpg</span>
</code></pre></div></li></ul></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">3/12/2021, 9:51:50 AM</span></div></div> <!----> </div> <!----></div></div>
    <script src="/Blog/assets/js/app.2159d4b3.js" defer></script><script src="/Blog/assets/js/2.14622190.js" defer></script><script src="/Blog/assets/js/22.89979eda.js" defer></script>
  </body>
</html>
